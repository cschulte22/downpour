(function(c){function f(a){return a.siblings("div.downpour_select_box")}function g(a){return a.siblings("div.downpour_option_box")}function k(a){var b=f(a),a=g(a);b.removeClass("downpour_select_box_focus");a.find("div.downpour_row").unbind("mouseover.downpour");a.find("div.downpour_row").unbind("mouseout.downpour");a.find("div.downpour_row").unbind("click.downpour");c(document).unbind("keydown.downpour");c(document).unbind("click.downpour");a.hide()}function n(a){if(27==a.which)h().downpour("blur"),
a.preventDefault();else if(38==a.which){var b=g(h()),d=b.find("div.downpour_row_hover");0==d.length&&(d=b.find("div.downpour_row_selected"));var c=d.prev("div.downpour_row");0==c.length&&(c=b.find("div.downpour_row").last());d.removeClass("downpour_row_hover");c.addClass("downpour_row_hover");l(b);a.preventDefault()}else 40==a.which?(b=g(h()),d=b.find("div.downpour_row_hover"),0==d.length&&(d=b.find("div.downpour_row_selected")),c=d.next("div.downpour_row"),0==c.length&&(c=b.find("div.downpour_row").first()),
d.removeClass("downpour_row_hover"),c.addClass("downpour_row_hover"),l(b),a.preventDefault()):13==a.which&&(h().downpour("select"),a.preventDefault())}function h(){return jQuery("div.downpour_option_box").filter(":visible").prevAll("select")}function l(a){var b=a.find("div.downpour_row_hover");if(b){var c=a.scrollTop(),e=b.position().top,i=a.outerHeight(),b=b.outerHeight();(e+b>c+i||e<c)&&a.scrollTop(e)}}function m(a,b){var d=g(a),e=null;a.find("option").each(function(){var a=c('<div class="downpour_row">'+
c(this).html()+"</div>");a.data("downpour_value",c(this).attr("value"));b&&a.css({"white-space":"nowrap"});c(this).is(":selected")&&(e=a);a.addClass(c(this).attr("class"));d.append(a)});null!=e?f(a).html(e.html()):f(a).html("");return e}function o(){var a=0;c("div").each(function(){var b=parseInt(c(this).css("z-index"));b>a&&(a=b)});return a}var p={"class":"",nowrap:!1},j={init:function(a){return this.each(function(){var b=c(this);a=c.extend({},p,a);var d=b.attr("id"),e=b.data("downpour")||{};if(e.id)return b;
b.wrap('<div class="downpour_wrap"/>');var i=b.parent("div.downpour_wrap");i.css({position:"relative",overflow:"visible"});i.addClass(b.attr("class"));b.hide();i.append('<div class="downpour_select_box" />');f(b).css({position:"absolute",top:"0px",left:"0px",width:b.css("width")});f(b).bind("click.downpour",function(a){a.stopPropagation();a=c(this).siblings("select");g(a).is(":visible")?a.downpour("blur"):a.downpour("focus")});i.append('<div class="downpour_option_box" />');g(b).css({display:"none",
position:"absolute",top:"0px",left:"0px","min-width":f(b).outerWidth()+"px","z-index":o()+1});var h=m(b,a.nowrap);i.css({height:f(b).outerHeight(),width:f(b).outerWidth()});e.id=d;e.settings=a;null!=h&&(e.selected=h.data("downpour_value"));b.data("downpour",e);return b})},focus:function(){return this.each(function(){var a=c(this),b=f(a),d=g(a);if(!d.is(":visible")){b.addClass("downpour_select_box_focus");d.css({top:b.outerHeight()+"px"});d.find("div.downpour_row_hover").removeClass("downpour_row_hover");
d.find("div.downpour_row_selected").removeClass("downpour_row_selected");b=d.find("div.downpour_row");b.bind("mouseover.downpour",function(){c(this).siblings("div.downpour_row_hover").removeClass("downpour_row_hover");c(this).addClass("downpour_row_hover")});b.bind("mouseout.downpour",function(){c(this).removeClass("downpour_row_hover")});b.bind("click.downpour",function(){h().downpour("select")});c(document).bind("keydown.downpour",n);c(document).bind("click.downpour",function(){h().downpour("blur")});
var e=a.data("downpour");void 0!==e.selected&&null!=e.selected&&d.find("div.downpour_row").each(function(){c(this).data("downpour_value")==e.selected&&c(this).addClass("downpour_row_hover downpour_row_selected")});d.show()}})},blur:function(){return this.each(function(){var a=c(this);k(a);var b=a.data("downpour");void 0!==b.settings.blur&&b.settings.blur.apply(a)})},select:function(){return this.each(function(){var a=c(this),b=g(a).find("div.downpour_row_hover");a.downpour("selected",b.data("downpour_value"));
a.siblings("div.downpour_select_box").html(b.html());k(a);var d=a.data("downpour");void 0!==d.settings.select&&d.settings.select.apply(a,[b.data("downpour_value"),b.html()])})},selected:function(a){return this.each(function(){var b=c(this),d=b.data("downpour");if(void 0===a)return d.selected;d.selected=a;b.val(a)})},reload_options:function(){return this.each(function(){var a=c(this),b=a.data("downpour");g(a).empty();a=m(a,b.settings.nowrap);null!=a&&(b.selected=a.data("downpour_value"))})}};c.fn.downpour=
function(a){if(j[a])return j[a].apply(this,Array.prototype.slice.call(arguments,1));if("object"===typeof a||!a)return j.init.apply(this,arguments);c.error("Method "+a+" does not exist on jQuery.downpour")}})(jQuery);