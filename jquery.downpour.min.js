(function(d){function g(a){return a.siblings("div.downpour_select_box")}function h(a){return a.siblings("div.downpour_option_box")}function m(a){var b=g(a),a=h(a);b.removeClass("downpour_select_box_focus");a.find("div.downpour_row").off("mouseover.downpour");a.find("div.downpour_row").off("mouseout.downpour");a.find("div.downpour_row").off("click.downpour");d(document).off("keydown.downpour");d(document).off("click.downpour");a.hide()}function q(a){if(27==a.which)f().downpour("blur"),a.preventDefault();
else if(38==a.which){var b=h(f()),c=b.find("div.downpour_row_hover");0==c.length&&(c=b.find("div.downpour_row_selected"));var e=c.prev("div.downpour_row");0==e.length&&(e=b.find("div.downpour_row").last());c.removeClass("downpour_row_hover");e.addClass("downpour_row_hover");k(b,"up");a.preventDefault()}else 40==a.which?(b=h(f()),c=b.find("div.downpour_row_hover"),0==c.length&&(c=b.find("div.downpour_row_selected")),e=c.next("div.downpour_row"),0==e.length&&(e=b.find("div.downpour_row").first()),c.removeClass("downpour_row_hover"),
e.addClass("downpour_row_hover"),k(b,"down"),a.preventDefault()):13==a.which&&(f().downpour("select"),a.preventDefault())}function f(){return jQuery("div.downpour_option_box").filter(":visible").prevAll("select")}function k(a,b){var c=a.find("div.downpour_row_hover");if(c){var e=a.scrollTop(),d=c.position().top+e,i=a.outerHeight(),c=c.outerHeight(),i=e+i,g=d+c,h=!1;d>=e&&(d<=i&&g<=i&&g>=e)&&(h=!0);if(!h){var f=a.find("div.downpour_row");a.find("div.downpour_row").off("mouseover.downpour");a.find("div.downpour_row").off("mouseout.downpour");
"up"==b?(e=d-c,0>e&&(e=0),a.scrollTop(e)):a.scrollTop(d);window.setTimeout(function(){f.on("mouseover.downpour",n);f.on("mouseout.downpour",o)},400)}}}function p(a,b,c){var e=h(a),f=null;a.find("option").each(function(){var a=d('<div class="downpour_row">'+d(this).html()+"</div>");a.data("downpour_value",d(this).attr("value"));b&&a.css({"white-space":"nowrap"});d(this).is(":selected")&&(f=a);a.addClass(d(this).attr("class"));c&&""==d.trim(a.html())&&a.html("&nbsp;");e.append(a)});null!=f?g(a).html(f.html()):
g(a).html("");return f}function n(){d(this).siblings("div.downpour_row_hover").removeClass("downpour_row_hover");d(this).addClass("downpour_row_hover")}function o(){d(this).removeClass("downpour_row_hover")}function r(){var a=0;d("div").each(function(){var b=parseInt(d(this).css("z-index"));b>a&&(a=b)});return a}var s={"class":"",nowrap:!1,auto_nbsp:!1},l={init:function(a){return this.each(function(){var b=d(this);a=d.extend({},s,a);var c=b.attr("id"),e=b.data("downpour")||{};if(e.id)return b;b.wrap('<div class="downpour_wrap"/>');
var j=b.parent("div.downpour_wrap");j.css({position:"relative",overflow:"visible"});j.addClass(b.attr("class"));b.hide();j.append('<div class="downpour_select_box" />');g(b).css({position:"absolute",top:"0px",left:"0px",width:b.outerWidth()+"px"});g(b).on("click.downpour",function(a){a.stopPropagation();var a=d(this).siblings("select"),b=f();0==b.length||b==a?h(a).is(":visible")?a.downpour("blur"):a.downpour("focus"):b.downpour("blur")});j.append('<div class="downpour_option_box" />');h(b).css({display:"none",
position:"absolute",top:"0px",left:"0px","min-width":g(b).outerWidth()+"px","z-index":r()+1});var i=p(b,a.nowrap,a.auto_nbsp);j.css({height:g(b).outerHeight(),width:g(b).outerWidth()});e.id=c;e.settings=a;null!=i&&(e.selected=i.data("downpour_value"));b.data("downpour",e);return b})},focus:function(){return this.each(function(){var a=d(this),b=g(a),c=h(a);if(!c.is(":visible")){b.addClass("downpour_select_box_focus");c.css({top:b.outerHeight()+"px"});c.find("div.downpour_row_hover").removeClass("downpour_row_hover");
c.find("div.downpour_row_selected").removeClass("downpour_row_selected");b=c.find("div.downpour_row");b.on("mouseover.downpour",n);b.on("mouseout.downpour",o);b.on("click.downpour",function(){f().downpour("select")});d(document).on("keydown.downpour",q);d(document).on("click.downpour",function(){f().downpour("blur")});var e=a.data("downpour");void 0!==e.selected&&null!=e.selected&&c.find("div.downpour_row").each(function(){d(this).data("downpour_value")==e.selected&&d(this).addClass("downpour_row_hover downpour_row_selected")});
c.show();k(c,"down")}})},blur:function(){return this.each(function(){var a=d(this);m(a);var b=a.data("downpour");void 0!==b.settings.blur&&b.settings.blur.apply(a)})},select:function(){return this.each(function(){var a=d(this),b=h(a).find("div.downpour_row_hover");a.downpour("selected",b.data("downpour_value"));a.siblings("div.downpour_select_box").html(b.html());m(a);var c=a.data("downpour");void 0!==c.settings.select&&c.settings.select.apply(a,[b.data("downpour_value"),b.html()])})},selected:function(a){return this.each(function(){var b=
d(this),c=b.data("downpour");if(void 0===a)return c.selected;c.selected=a;b.val(a)})},reload_options:function(){return this.each(function(){var a=d(this),b=a.data("downpour");h(a).empty();a=p(a,b.settings.nowrap,b.settings.auto_nbsp);null!=a&&(b.selected=a.data("downpour_value"))})}};d.fn.downpour=function(a){if(l[a])return l[a].apply(this,Array.prototype.slice.call(arguments,1));if("object"===typeof a||!a)return l.init.apply(this,arguments);d.error("Method "+a+" does not exist on jQuery.downpour")}})(jQuery);